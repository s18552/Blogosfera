{% extends 'base.html' %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h2 class="mb-4">Welcome to My App</h2>
      <a href="/create_post" class="btn btn-primary">Create Post</a>
      <hr>
      {% for post in posts %}
        <div class="post">
          <h2>{{ post.title }}</h2>
          <p>{{ post.content }}</p>
          <p>Author: {{ post.author.email }}</p>
          <p>Created At: {{ post.created_at }}</p>
          <p>Comments: {{ post.comments.count() }}</p>
          
          {% if current_user.is_authenticated and current_user.id == post.author_id %}
            <div class="post-actions">
              <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn btn-primary">Edit</a>
              <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn btn-danger">Delete</a>
            </div>
          {% endif %}
        </div>
        <hr>
        <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}" enctype="multipart/form-data">
          {{ comment_form.hidden_tag() }}
          <input type="hidden" name="post_id" value="{{ post.id }}">
          <div class="form-group">
            {{ comment_form.content.label(class='form-control-label') }}
            {{ comment_form.content(class='form-control') }}
            {% if comment_form.content.errors %}
              <div class="alert alert-danger mt-2">
                {% for error in comment_form.content.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          <button type="submit" class="btn btn-primary">Add Comment</button>
        </form>
        <hr>
      {% endfor %}
    </div>
  </div>
{% endblock %}
